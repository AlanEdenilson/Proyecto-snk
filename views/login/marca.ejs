<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheet/c2/marca.css">
    <title></title>
</head>
<body>
<style>
    .error { color: red; }
    #vistaPrevia {
                width: 200px;
                height: 200px;
                border: 2px solid #ddd;
                border-radius: 10px;
                display: none;
                left: 65px;
                }
</style>

    <div class="container">
        <h2>REGISTRO DE MARCA</h2>
        <form id="marc" method="post" action="/adminr/marca" enctype="multipart/form-data" >
            <div class="form-group">
                <label for="name">Selecionar Logo:</label>
                <input type="file" id="imagen" name="imagen" accept="image/png">
                <b><span class="error" id="imagenError"></span></b>
                <img id="vistaPrevia" alt="Vista previa de la imagen">
            </div>

            <div class="form-group">
                <label for="email">Nombre de la Marca:</label>
                <input type="text" id="nombre" name="nombre" >
                <b><span class="error" id="nombreError"></span></b>
            </div>

            <div class="form-group">
                <label for="message">Descripcion de la Marca:</label>
                <textarea id="descrip" name="descripcion" ></textarea>
                <b><span class="error" id="desError"></span></b>
            </div>

            <div class="form-group">
                <label for="email">:</label>
                <input type="text" id="tipo" name="tipop" >
                <b><span class="error" id="tipoError"></span></b>
            </div>

            <button type="submit">Registrar</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#marc').on('submit', function(e) {
                let hasErrors = false;
                
                // Validar nombre marca
                const nombre = $('#nombre').val().trim();

                if (nombre === '') {
                $('#nombreError').text('El nombre de la marca es requerida');
                hasErrors = true;
                } else if (nombre.length < 3) {
                $('#nombreError').text('El nombre debe tener al menos 3 caracteres');
                hasErrors = true;
                } else {
                $('#nombreError').text('');
                }

                // Validar imagen
                const archivoInput = $('#imagen');
                const archivo = archivoInput[0].files[0];

                if (!archivo) {
                $('#imagenError').text('La imagen es requerida');
                hasErrors = true;
                } else if (archivo.type !== 'image/png') {
                $('#imagenError').text('Solo se permiten imágenes PNG');
                hasErrors = true;
                } else {
                $('#imagenError').text('');
                }

                //validar descripcion
                const descripcion = $('#descrip').val().trim();

                if (descripcion === '') {
                $('#desError').text('La descripcion es requerida');
                hasErrors = true;
                } else if (descripcion.length < 12) {
                $('#desError').text('La descripcion debe tener al menos 12 caracteres');
                hasErrors = true;
                } else {
                $('#desError').text('');
                }

                // Validar tipo producto
                const tipo = $('#tipo').val().trim();

                if (tipo === '') {
                $('#tipoError').text('El tipo de producto es requerida');
                hasErrors = true;
                } else if (tipo.length < 3) {
                $('#tipoError').text('El tipo de producto debe tener al menos 3 caracteres');
                hasErrors = true;
                } else {
                $('#tipoError').text('');
                }


                
                // Si hay errores, prevenir el envío del formulario
                if (hasErrors) {
                    e.preventDefault();
                }
            });
    
            // Quitar el borde rojo cuando el input obtiene el foco
            $('#nombre').on('input', function() {
                $('#nombreError').empty()
            });

            $('#imagen').on('input', function() {
                $('#imagenError').empty()
            });

            $('#descrip').on('input', function() {
                $('#desError').empty()
            });

            $('#tipo').on('input', function() {
                $('#tipoError').empty()
            });
    
            // Volver a validar cuando el input pierde el foco
            $('input').on('blur', function() {
                if ($(this).val().trim() === '') {
                    $(this).addClass('input-error');
                    $('#' + this.id + 'Error').text('Este campo es requerido');
                } else {
                    $(this).removeClass('input-error');
                    $('#' + this.id + 'Error').text('');
                }
            });

            $('textarea').on('blur', function() {
                if ($(this).val().trim() === '') {
                    $(this).addClass('input-error');
                    $('#' + this.id + 'Error').text('Este campo es requerido');
                } else {
                    $(this).removeClass('input-error');
                    $('#' + this.id + 'Error').text('');
                }
            });
        });
    </script>
     <script>
        document.getElementById('imagen').addEventListener('change', function(event) {
            const archivo = event.target.files[0];

            if (archivo && archivo.type.startsWith('image/')) {
                const img = document.getElementById('vistaPrevia');
                img.src = URL.createObjectURL(archivo);
                img.style.display = 'block';

                // Liberar la URL creada para evitar pérdidas de memoria
                img.onload = () => {
                    URL.revokeObjectURL(img.src);
                };
            } else {
                alert('Por favor, selecciona un archivo de imagen válido.');
            }
        });
    </script>
</body>
</html>